from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys

# Configure le navigateur headless
options = webdriver.ChromeOptions()
options.add_argument('--headless')
driver = webdriver.Chrome(options=options)

# Va sur le portail SSO
driver.get("https://sso.ton-entreprise.com/login")

# Remplis les champs
username_input = driver.find_element(By.NAME, "username")
password_input = driver.find_element(By.NAME, "password")

username_input.send_keys("ton_identifiant")
password_input.send_keys("ton_mot_de_passe")
password_input.send_keys(Keys.RETURN)

# Attends la redirection vers la page protégée
driver.implicitly_wait(10)

# Récupère le cookie de session ou token
cookies = driver.get_cookies()
print(cookies)

driver.quit()


from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
import time

# --- CONFIGURATION ---
URL_LOGIN = "https://sso.ton-entreprise.com/login"
IDENTIFIANT = "mon_identifiant"
MOT_DE_PASSE = "mon_mot_de_passe"

# --- OPTIONS CHROME ---
options = webdriver.ChromeOptions()
options.add_argument('--headless')  # Mode sans affichage
options.add_argument('--disable-gpu')
options.add_argument('--no-sandbox')
options.add_argument('--ignore-certificate-errors')  # Si certificat SSL interne
options.add_argument('--window-size=1920,1080')

# --- INITIALISATION ---
driver = webdriver.Chrome(options=options)

try:
    # Accès à la page de login
    driver.get(URL_LOGIN)

    # Attente explicite que les champs soient visibles
    WebDriverWait(driver, 10).until(EC.presence_of_element_located((By.NAME, "username")))

    # Remplir les champs
    username_input = driver.find_element(By.NAME, "username")
    password_input = driver.find_element(By.NAME, "password")

    username_input.send_keys(IDENTIFIANT)
    password_input.send_keys(MOT_DE_PASSE)
    password_input.send_keys(Keys.RETURN)

    # Attendre la redirection ou une page d'accueil
    WebDriverWait(driver, 15).until(EC.url_changes(URL_LOGIN))

    # Pause courte pour laisser le temps au cookie d'être posé
    time.sleep(2)

    # Récupération des cookies
    cookies = driver.get_cookies()
    for cookie in cookies:
        print(f"{cookie['name']} = {cookie['value']}")

    # (Optionnel) Utiliser le cookie avec requests ?
    # session = requests.Session()
    # for cookie in cookies:
    #     session.cookies.set(cookie['name'], cookie['value'])

except Exception as e:
    print(f"Erreur lors du login SSO : {e}")
finally:
    driver.quit()



import requests
from bs4 import BeautifulSoup

session = requests.Session()

# 1. Accès à la ressource protégée sur le SP
sp_url = "https://service-protected.example.com"
response = session.get(sp_url)

# 2. Extraire le formulaire SAML de redirection vers l’IdP
soup = BeautifulSoup(response.text, "html.parser")
form = soup.find("form")
saml_action = form["action"]
inputs = {i["name"]: i["value"] for i in form.find_all("input")}

# 3. Envoi de la requête SAML vers l’IdP
response = session.post(saml_action, data=inputs)

# 4. Simuler la soumission du formulaire d’authentification de l’IdP
soup = BeautifulSoup(response.text, "html.parser")
login_form = soup.find("form")
login_url = login_form["action"]
login_data = {
    i["name"]: i.get("value", "") for i in login_form.find_all("input")
}
login_data["username"] = "mon_identifiant"
login_data["password"] = "mon_mot_de_passe"

response = session.post(login_url, data=login_data)

# 5. Récupération du formulaire SAMLResponse
soup = BeautifulSoup(response.text, "html.parser")
saml_form = soup.find("form")
saml_post_url = saml_form["action"]
saml_response_data = {
    i["name"]: i["value"] for i in saml_form.find_all("input")
}

# 6. Envoi de la réponse SAML au SP
response = session.post(saml_post_url, data=saml_response_data)

# 7. Si tout est correct, tu es maintenant connecté
print("Statut final :", response.status_code)
print("Page protégée :", response.url)
